<div class="settings-container">
  <header class="page-header">
    <h1>Settings & Backup</h1>
    <p class="subtitle">Manage your data and application settings.</p>
  </header>

  <div class="settings-card">
    <h2>Cloud Sync & Cloud Security</h2>
    <p class="description">
      @if (authService.isAuthenticated()) {
        Connected as <strong>{{ authService.currentUser()?.username }}</strong>. Your data can be synchronized with the cloud.
      } @else {
        Sign in to synchronize your data automatically across devices.
      }
    </p>

    <div class="actions">
      @if (authService.isAuthenticated()) {
        <div class="action-group">
          <h3>Cloud Sync</h3>
          <p>Push your current local data to your secure cloud account.</p>
          <button class="btn btn-primary" [disabled]="syncStatus() === 'syncing'" (click)="syncWithCloud()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.5 19c.707 0 1.346-.287 1.812-.75.465-.463.75-1.1.75-1.808a2.556 2.556 0 0 0-2.5 0 2.556 2.556 0 0 0-2.5 2.5c0 .707.287 1.346.75 1.812.463.465 1.1.75 1.808.75z"/><path d="M12 13v5"/><path d="M12 18l-3-3"/><path d="M12 18l3-3"/><path d="M20 17.58A5 5 0 0 0 18 8a7 7 0 1 0-13.3 3.6"/></svg>
            {{ syncStatus() === 'syncing' ? 'Syncing...' : 'Sync Now' }}
          </button>
          
          @if (syncStatus() === 'success') {
            <p class="hint success">Cloud sync complete!</p>
          }
        </div>
      } @else {
        <div class="action-group">
          <h3>Link Account</h3>
          <p>Login or Register to enable cloud features.</p>
          <div class="auth-options">
            <a routerLink="/login" class="btn btn-primary">Login</a>
            <a routerLink="/register" class="btn btn-secondary">Register</a>
          </div>
        </div>
      }
    </div>
  </div>

  <div class="settings-card">
    <h2>Local Backup & Manual Restore</h2>
    <p class="description">
      Download a copy of your budget data to your device, or restore from a previous backup.
    </p>

    <div class="actions">
      <div class="action-group">
        <h3>Export Data</h3>
        <p>Save your current budget and history to a JSON file.</p>
        <button class="btn btn-secondary" (click)="exportData()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          Export Backup
        </button>
      </div>

      <div class="action-group">
        <h3>Import Data</h3>
        <p>Restore your budget from a previously saved backup file.</p>
        <label class="btn btn-secondary file-label">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
          Upload Backup
          <input type="file" (change)="onFileSelected($event)" accept=".json" hidden>
        </label>

        @if (importStatus === 'success') {
          <p class="hint success">Restore complete!</p>
        } @else if (importStatus === 'error') {
          <p class="hint error">{{ errorMessage }}</p>
        }
      </div>
    </div>
  </div>

  <!-- Danger Zone -->
  <div class="settings-card danger-section">
    <h2 class="danger-title">Danger Zone</h2>
    <p class="description">
      These actions are permanent and cannot be undone. 
    </p>

    <div class="actions">
      <div class="action-group danger">
        <h3>Factory Reset</h3>
        <p>Permanently delete all budget entries, history, and earnings configuration from this browser. This does not affect your cloud account if synchronized.</p>
        <button class="btn btn-danger" (click)="factoryReset()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
          Clear All Data
        </button>
      </div>
    </div>
  </div>
</div>
